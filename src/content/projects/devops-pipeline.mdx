---
title: "GitOps 기반 CI/CD 파이프라인 구축"
period: "2023.06 - 2023.09"
role: "DevOps Engineer"
stack: ["GitHub Actions", "ArgoCD", "Kubernetes", "Terraform", "AWS", "Docker"]
links:
  github: "https://github.com/projectmiluju/gitops-pipeline"
highlights:
  - "GitOps 기반 선언적 인프라 관리"
  - "배포 자동화로 릴리스 주기 단축"
  - "IaC로 환경 간 일관성 확보"
metrics:
  - "배포 시간 2시간 → 15분 (87.5% 단축)"
  - "휴먼 에러 95% 감소"
  - "인프라 프로비저닝 시간 1일 → 30분"
cover: "/images/projects/devops-cover.png"
order: 2
---

## 문제 정의

기존 배포 프로세스의 문제점:
- 수동 배포로 인한 휴먼 에러 빈발 (월 평균 3건)
- 환경별 설정 불일치로 "내 로컬에서는 됐는데" 문제
- 롤백 시간 과다 (평균 45분)

## 역할과 범위

**역할**: DevOps 파이프라인 설계 및 구축 전담  
**범위**: CI/CD 파이프라인, IaC, 모니터링/알림 시스템

---

## 아키텍처

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   GitHub    │────▶│   GitHub    │────▶│   ArgoCD    │
│ (Source)    │     │  Actions    │     │ (GitOps)    │
└─────────────┘     └─────────────┘     └─────────────┘
                           │                   │
                           ▼                   ▼
                    ┌─────────────┐     ┌─────────────┐
                    │    ECR      │     │ Kubernetes  │
                    │ (Registry)  │     │  Cluster    │
                    └─────────────┘     └─────────────┘
                                               │
                    ┌──────────────────────────┤
                    ▼                          ▼
              ┌─────────────┐          ┌─────────────┐
              │   Dev Env   │          │  Prod Env   │
              └─────────────┘          └─────────────┘
```

---

## 핵심 구현

### 1. GitHub Actions CI 파이프라인

```yaml
name: CI Pipeline
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Tests
        run: ./gradlew test
      
  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Build & Push Docker Image
        uses: docker/build-push-action@v5
        with:
          push: true
          tags: ${{ env.ECR_REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
```

### 2. ArgoCD 기반 GitOps CD

```yaml
# application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: ecommerce-api
spec:
  project: default
  source:
    repoURL: https://github.com/projectmiluju/k8s-manifests
    targetRevision: HEAD
    path: overlays/production
  destination:
    server: https://kubernetes.default.svc
    namespace: production
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
```

### 3. Terraform IaC

```hcl
# EKS 클러스터 프로비저닝
module "eks" {
  source          = "terraform-aws-modules/eks/aws"
  cluster_name    = var.cluster_name
  cluster_version = "1.28"
  
  vpc_id     = module.vpc.vpc_id
  subnet_ids = module.vpc.private_subnets
  
  eks_managed_node_groups = {
    main = {
      desired_size = 3
      min_size     = 2
      max_size     = 10
      instance_types = ["t3.large"]
    }
  }
}
```

---

## 트러블슈팅

### 이슈 1: ArgoCD Sync 무한 루프

**현상**: 특정 리소스가 계속 OutOfSync 상태 유지

**원인**: Kubernetes가 자동 생성하는 필드(status, metadata.generation)를 ArgoCD가 diff로 인식

**해결**: ignoreDifferences 설정 추가
```yaml
spec:
  ignoreDifferences:
    - group: apps
      kind: Deployment
      jsonPointers:
        - /spec/replicas
```

**재발 방지**: ArgoCD 리소스 템플릿에 표준 ignoreDifferences 포함

---

### 이슈 2: Secret 관리 보안 문제

**현상**: Git에 민감 정보 노출 우려

**원인**: GitOps 특성상 모든 설정이 Git에 저장되어야 함

**해결**: Sealed Secrets + External Secrets Operator 도입
```yaml
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: db-credentials
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  target:
    name: db-credentials
  data:
    - secretKey: password
      remoteRef:
        key: prod/db/password
```

**재발 방지**: Secret 관리 가이드라인 문서화, PR 리뷰 시 체크리스트 추가

---

## 성과

| 지표 | Before | After | 개선율 |
|------|--------|-------|--------|
| 배포 소요시간 | 2시간 | 15분 | 87.5% ↓ |
| 휴먼 에러 | 월 3건 | 월 0.15건 | 95% ↓ |
| 롤백 시간 | 45분 | 2분 | 95.6% ↓ |
| 릴리스 빈도 | 월 2회 | 주 3회 | 6배 ↑ |

---

## 프론트엔드 기여

- **Preview 환경 자동 생성**: PR마다 임시 환경 자동 배포로 QA 효율화
- **프론트엔드 빌드 캐싱**: node_modules 캐싱으로 빌드 시간 60% 단축
- **CDN 캐시 무효화 자동화**: 배포 시 CloudFront 캐시 자동 갱신

---

## 회고 및 다음 개선

### 잘한 점
- 점진적 도입으로 팀 적응 시간 확보
- 상세한 Runbook 작성으로 온콜 부담 감소

### 개선할 점
- 초기 학습 곡선이 가팔랐음 → 내부 교육 세션 필요
- 모니터링 알림 과다 → 알림 튜닝 필요

### 다음 개선 계획
- Argo Rollouts 도입으로 Canary 배포 자동화
- Policy as Code(OPA Gatekeeper) 도입
